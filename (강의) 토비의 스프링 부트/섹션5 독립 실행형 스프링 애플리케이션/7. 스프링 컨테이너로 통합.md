기존에는 서블릿을 등록하는 작업과 스프링 컨테이너를 생성하는 작업이 분리돼있었다.

이번에는 서블릿 컨테이너를 만들고 서블릿을 초기화 하는 작업을 스프링 컨테이너가 초기화 되는 과정 중에 일어나도록 만들 것이다.

스프링 컨테이너를 초기화하는 중에 추가로 어떤 작업을 수행하도록 만들 수 있는데 아래에 GenericWebApplicationContext를 상속 받아서 onRefresh라는 메서드를 재정의 하는 방식으로 만들 수 있다.

```java
public class TobyspringbootApplication {

	public static void main(String[] args) {
		// 스프링 컨테이너 만들기
		GenericWebApplicationContext applicationContext = new GenericWebApplicationContext() {
			@Override
			protected void onRefresh() {
				super.onRefresh();

				ServletWebServerFactory serverFactory = new TomcatServletWebServerFactory();

				// 서블릿 컨테이너를 만드는 생성 함수
				WebServer webServer = serverFactory.getWebServer(servletContext -> {
					servletContext.addServlet("dispatcherServlet",
						new DispatcherServlet(this)
					).addMapping("/*"); // / 밑으로 들어오는 모든 요청을 처리 => 프론트 컨트롤러의 역할
				});
				// 톰캣 서블릿 컨테이너 동작
				webServer.start();
			}
		};
		applicationContext.registerBean(HelloController.class); // 빈 등록
		applicationContext.registerBean(SimpleHelloService.class);
		applicationContext.refresh(); // 빈 오브젝트를 만드는 작업

	}

}
```
