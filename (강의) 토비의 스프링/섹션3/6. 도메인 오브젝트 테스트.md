- 도메인 모델 아키텍처 패턴

  - 도메인 로직, 비즈니스 로직을 어디에 둘지 결정하는 패턴

  - 트랜잭션 스크립트 - 서비스 메서드

    비즈니스 로직을 서비스 메서드 안에 다 몰아넣는 방식이다.

    모든 비즈니스 로직을 다 몰아넣어서 초반 작성은 쉽지만 나중에 유지보수가 어렵다는 단점이 있다.

  - 도메인 모델 - 도메인 모델 오브젝트

    기능을 처리하는 로직이 도메인 모델 안에 작성된다.

    이렇게 되면 응집도가 높아져서 유지보수가 용이하다는 장점이 있다. 코드를 수정할 때 해당 도메인만 찾아서 수정하면 된다.

```java
public class Payment {
	private Long orderId;
	private String currency;
	private BigDecimal foreignCurrencyAmount;
	private BigDecimal convertedAmount;
	private LocalDateTime validUntil;

	public Payment(Long orderId, String currency, BigDecimal foreignCurrencyAmount, BigDecimal exRate,
		BigDecimal convertedAmount, LocalDateTime validUntil) {
		this.orderId = orderId;
		this.currency = currency;
		this.foreignCurrencyAmount = foreignCurrencyAmount;
		this.exRate = exRate;
		this.convertedAmount = convertedAmount;
		this.validUntil = validUntil;
	}

	public static Payment createPrepared(Long orderId, String currency, BigDecimal foreignCurrencyAmount,
		BigDecimal exRate, LocalDateTime now) {
		BigDecimal convertedAmount = foreignCurrencyAmount.multiply(exRate);
		LocalDateTime validUntil = now.plusMinutes(30);

		return new Payment(orderId, currency, foreignCurrencyAmount, exRate, convertedAmount, validUntil);
	}

	public boolean isValid(Clock clock) {
		return LocalDateTime.now(clock).isBefore(this.validUntil);
	}
}





public class PaymentTest {
	@Test
	void createPrepared() {
		Clock clock = Clock.fixed(Instant.now(), ZoneId.systemDefault());

		Payment payment = Payment.createPrepared(
			1L, "USD", BigDecimal.TEN, BigDecimal.valueOf(1_000), LocalDateTime.now(clock)
		);

		assertThat(payment.getConvertedAmount()).isEqualByComparingTo(BigDecimal.valueOf(10_000));
		assertThat(payment.getValidUntil()).isEqualTo(LocalDateTime.now(clock).plusMinutes(30));
	}

	@Test
	void isValid() {
		Clock clock = Clock.fixed(Instant.now(), ZoneId.systemDefault());

		Payment payment = Payment.createPrepared(
			1L, "USD", BigDecimal.TEN, BigDecimal.valueOf(1_000), LocalDateTime.now(clock)
		);

		Assertions.assertThat(payment.isValid(clock)).isTrue();
		Assertions.assertThat(payment.isValid(Clock.offset(clock, Duration.of(30, ChronoUnit.MINUTES)))).isFalse();
	}
}

```
