`TomcatServletWebServerFactory` , `DispatcherServlet` 도 빈으로 등록해서 스프링 컨테이너가 관리하도록 한다.

`DispatcherServlet` 은 ApplicationContextAware라는 스프링 컨테이너를 setter로 주입해주는 메소드를 가진 인터페이스를 구현해놔서 스프링은 applicationContext를 알아서 주입을 해주는 것이다.

그래서 따로 applicationContext를 주입해주는 코드가 없어도 동작하는 것이다.

```java
@Configuration
@ComponentScan
public class TobyspringbootApplication {

	@Bean
	public ServletWebServerFactory servletWebServerFactory() {
		return new TomcatServletWebServerFactory();
	}

	@Bean
	public DispatcherServlet dispatcherServlet() {
		return new DispatcherServlet();
	}

	public static void main(String[] args) {
		// 스프링 컨테이너 만들기
		AnnotationConfigWebApplicationContext applicationContext = new AnnotationConfigWebApplicationContext() {
			@Override
			protected void onRefresh() {
				super.onRefresh();

				ServletWebServerFactory serverFactory = this.getBean(ServletWebServerFactory.class);
				DispatcherServlet dispatcherServlet = this.getBean(DispatcherServlet.class);

				// 서블릿 컨테이너를 만드는 생성 함수
				WebServer webServer = serverFactory.getWebServer(servletContext -> {
					servletContext.addServlet("dispatcherServlet", dispatcherServlet
					).addMapping("/*"); // / 밑으로 들어오는 모든 요청을 처리 => 프론트 컨트롤러의 역할
				});
				// 톰캣 서블릿 컨테이너 동작
				webServer.start();
			}
		};
		applicationContext.register(TobyspringbootApplication.class);
		applicationContext.refresh(); // 빈 오브젝트를 만드는 작업

	}

}
```
