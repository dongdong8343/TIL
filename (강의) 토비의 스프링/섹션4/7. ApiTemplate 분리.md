- 사람들이 읽을 경우, 미래에 내가 읽을 경우를 대비해서 이름을 잘 짓는 것도 중요하다.

- ApiTemplate

  - 환율 정보를 api로부터 환율을 가져오는 기능 제공

  - api 호출과 정보 추출의 기본 틀 제공

  - 두 가지 콜백 사용

  - 유사한 여러 오브젝트에서 재사용 가능

1. Template 분리

   ```java
   public class ApiTemplate {
       // 템플릿
       public BigDecimal getExRate(String url, ApiExecutor apiExecutor, ExRateExtractor exRateExtractor) {
           URI uri;
           try {
               uri = new URI(url);
           } catch (URISyntaxException e) {
               throw new RuntimeException(e);
           }

           String response;
           try {
               response = apiExecutor.execute(uri);
           } catch (IOException e) {
               throw new RuntimeException(e);
           }

           try {
               return exRateExtractor.extract(response);
           } catch (JsonProcessingException e) {
               throw new RuntimeException(e);
           }
       }
   }
   ```

2. WebApiExRateProvider에서 Template 호출

```java
@Component
public class WebApiExRateProvider implements ExRateProvider {
	// 변하지 않는 기본 틀이라서 서로 공유해도 상관 없음
	ApiTemplate apiTemplate = new ApiTemplate();

	@Override
	public BigDecimal getExRate(String currency) {
		String url = "https://open.er-api.com/v6/latest/" + currency;

		// 변하는 형태를 가진 코드인 콜백을 전달
		return apiTemplate.getExRate(url, new HttpClientApiExecutor(), new ErApiExRateExtractor());
	}
}
```

3. uri 통해 데이터 가져오는 메서드를 자바 11 버전의 Http 메서드를 활용해볼 것이다.

   기존 메서드에서는 자바의 오래된 원시적인 코드를 사용했다. 그래서 자바 11 버전의 HttpClient를 사용하는 코드로 수정했다.

   ```java
   public interface ApiExecutor {
       String execute(URI uri) throws IOException;
   }





   public class HttpClientApiExecutor implements ApiExecutor {
       @Override
       public String execute(URI uri) throws IOException {
           HttpRequest request = HttpRequest.newBuilder()
               .uri(uri)
               .GET()
               .build();

           try(HttpClient client = HttpClient.newBuilder().build()) {
               return client.send(request, HttpResponse.BodyHandlers.ofString()).body();
           } catch (InterruptedException e) {
               throw new RuntimeException(e);
           }

       }
   }
   ```
