- 템플릿에서 매번 콜백을 넣어주지 않더라도 자동으로 콜백을 디폴트 값으로 넣어줄 수 있는 방법이 존재한다.

  - 템플릿에서 생성자를 통해 콜백을 받을 수 있다.

- 특정 정보를 바탕으로 빈을 만드는 경우는 싱글톤으로 만들면 안된다. 매번 빈을 만들 때 특정 정보가 바뀌면서 데이터가 꼬일 수 있기 때문이다.

- 하지만 템플릿은 변하지 않는 틀이고 정보에 따라 만들어지는 것이 아니기 때문에 싱글톤으로 만들어도된다.

1. ApiTemplate에 콜백으로 사용할 클래스를 선언하고 생성자로 받기

   ```java
   public class ApiTemplate {
       private final ApiExecutor apiExecutor;
       private final ExRateExtractor exRateExtractor;

       public ApiTemplate() {
           this.apiExecutor = new HttpClientApiExecutor();
           this.exRateExtractor = new ErApiExRateExtractor();
       }

       public ApiTemplate(ApiExecutor apiExecutor, ExRateExtractor exRateExtractor) {
           this.apiExecutor = apiExecutor;
           this.exRateExtractor = exRateExtractor;
       }

       ...
   }
   ```

2. WebApiExRateProvider 에서 ApiTemplate 생성자로 받기

   ```java
   @Component
   public class WebApiExRateProvider implements ExRateProvider {
       // 변하지 않는 기본 틀이라서 서로 공유해도 상관 없음
       private final ApiTemplate apiTemplate;

       public WebApiExRateProvider(ApiTemplate apiTemplate) {
           this.apiTemplate = apiTemplate;
       }

       @Override
       public BigDecimal getExRate(String currency) {
           String url = "https://open.er-api.com/v6/latest/" + currency;

           // 변하는 형태를 가진 코드인 콜백을 전달
           return apiTemplate.getForExRate(url);
       }
   }
   ```

3. 구성 정보를 담당하는 PaymentConfig 수정

   ```java
   @Configuration
   public class PaymentConfig {
       @Bean
       public PaymentService paymentService() {
           return new PaymentService(exRateProvider(), clock());
       }

       @Bean
       public ExRateProvider exRateProvider() {
           return new WebApiExRateProvider(apiTemplate());
       }

       @Bean
       public ApiTemplate apiTemplate() { return new ApiTemplate(new SImpleApiExecutor(), new ErApiExRateExtractor()); }

       @Bean
       public Clock clock() {
           return Clock.systemDefaultZone();
       }
   }
   ```
