[피부 커뮤니티 - 요구 사항 정리](<https://github.com/dongdong8343/TIL/blob/main/(Project)%ED%94%BC%EB%B6%80%20%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0/%EC%9A%94%EA%B5%AC%20%EC%82%AC%ED%95%AD%20%EC%A0%95%EB%A6%ACv1.md>)

### 전체 ERD

요구 사항을 토대로 erd를 작성해봤다.

<center>
  <img
    src="https://github.com/user-attachments/assets/5b00f8be-292e-446b-9ab7-22c5c2c526d6"
    width="100%"
  />
</center>

### 유저

<center>
  <img
    src="https://github.com/user-attachments/assets/dfc76bb1-cb34-4a6b-a3c0-5a2c1b81580c"
    width="100%"
  />
</center>

소셜 로그인을 할 수도 있고 자체 로그인도 할 수 있어서 로그인 타입 필드를 만들어줬다.

그리고 일단 유저 권한은 간단하게 관리자와 사용자로 나눌 계획이다.

유저와 유저 권한 사이에 다대다 관계가 형성된다. 한 유저는 여러 권한을 가질 수 있고 하나의 권한은 여러 유저에 포함될 수 있다. 하지만 다대다 관계를 그대로 표시하게되면 테이블 내에 중복 데이터들이 저장되고 어떤 한 데이터를 수정한다고 가정했을 때 중복된 여러 데이터를 수정해야하기 때문에 비효율적이다.

이를 해결하기 위해서 중간 테이블을 만들어서 다대다 관계를 풀어줬다. 그럼 위의 사진처럼 erd가 만들어진다.

### 게시글

<center>
  <img
    src="https://github.com/user-attachments/assets/a244c0f8-64a5-4a4d-a006-57bee86d1fca"
    width="50%"
  />
</center>

한 사람이 여러 게시글을 작성할 수 있기 때문에 유저와 1:N 관계를 맺는다.

게시글을 삭제했다가 복구해야하는 경우가 발생할 수 있기 때문에 soft delete로 구현할 예정이다. 그래서 삭제 시간(여부)을 저장할 deleted_at 필드를 만들었다.

### 파일

<center>
  <img
    src="https://github.com/user-attachments/assets/966b51f8-5e5f-4413-ac90-7ce580773138"
    width="50%"
  />
</center>

한 게시글의 여러 파일이 있을 수 있기 때문에 게시글과 1:N 관계를 맺는다.

실제 파일 이름이 중복이 발생할 수 있기 때문에 DB에 저장되는 파일 이름은 고유해야한다. 그래서 파일 이름과 실제 파일 이름 필드를 만들게 됐다.

파일의 실제 위치를 파악할 때 버킷 이름을 활용해서 찾는데 만약 버킷 이름을 저장하는 필드가 없고 url만으로 저장하면 나중에 마이그레이션을 할 때 문제가 발생한다.

버킷 이름 필드가 있다면 버킷 이름이 변경될 때 버킷 이름만 수정해주면 되기때문에 버킷 이름을 따로 필드에 저장하는 것이 좋다.

인터넷에서 파일 접근이 가능하도록 url 필드를 만들었다.

서버, 클라우드 내부에 저장된 경로를 저장하기 위해서 실제 파일 경로 필드를 만들었다.

### 좋아요

<center>
  <img
    src="https://github.com/user-attachments/assets/bc3b5405-bc68-429a-abf5-19df8e3ea85d"
    width="50%"
  />
</center>

좋아요는 한 유저가 한 게시글에 한 번만 누를 수 있다. 유저는 여러 게시글에 좋아요를 누를 수 있다. 게시글에 여러 사람들이 좋아요를 누른다.

그래서 위 사진과 같이 게시글과 유저와 관계를 맺으며 각 테이블과 1:N 관계를 맺게된다.

### 카테고리

<center>
  <img
    src="https://github.com/user-attachments/assets/9fe6d371-37cd-4587-a974-b8468ac58ebb"
    width="50%"
  />
</center>

한 카테고리에 여러 게시글이 존재할 수 있기 때문에 1:N 관계를 맺어줬다.

요구 사항 정리를 보면 카테고리에 서브 카테고리가 존재할 수 있다. 그래서 서브 카테고리는 부모 카테고리의 ID를 가질 수 있게했다.(제일 윗 레벨의 카테고리는 부모 카테고리 id를 안가져서 null이라고 표시했다.)

따라서 카테고리는 스스로를 참조하게 하는 저런 형태가 만들어졌다.

카테고리 코드 필드를 만들었는데 카테고리를 단순히 문자열로 관리하면 문자열에 오타가 있을 수도 있고 데이터가 일관되지 않으면 검색과 필터링이 어려워질 수 있다. 그래서 카테고리 코드 필드를 만들었다.

### 댓글

<center>
  <img
    src="https://github.com/user-attachments/assets/f6468b04-0270-48c9-a9e3-e5d3da17b6eb"
    width="50%"
  />
</center>

한 게시글에 여러 댓글이 달릴 수 있어서 1:N 관계를 가진다. 그리고 한 유저는 여러 댓글을 작성할 수 있어서 1:N 관계를 가진다.

아래와 같은 댓글 예시를 보자.

```
ㄴ 너무 맛있어 보여요
    ㄴ 아니에요 가지마세요
    ㄴ 여기 많이 맛없나요?
        ㄴ 네 진짜 최악입니다...
```

위의 댓글을 보면 한 댓글 밑에 여러 댓글이 달리고 또 그 댓글 밑에 여러 댓글이 달리는 구조를 가진다.

따라서 댓글의 순서가 섞이지 않도록 댓글의 깊이와 댓글의 순서를 저장하는 필드를 만들었다.

아까 카테고리 테이블에서 설명한 것처럼 한 카테고리가 서브 카테고리들을 가질 수 있는 것처럼 댓글도 동일하다. 그래서 댓글 테이블 스스로를 참조하며 부모의 댓글 id를 가질 수 있도록 했다.
