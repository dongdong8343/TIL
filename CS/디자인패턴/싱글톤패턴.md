### 싱글톤 패턴

- 하나의 클래스에 하나의 인스턴스만 가지는 패턴
- 장점
  - 하나의 인스턴스를 공유하기 때문에 생성할 때 비용 줄어든다. → I/O bound 작업에 사용하면 비용을 줄일 수 있어서 좋다.
  - I/O bound - 네트워크 통신, DB 연결과 같은 작업들은 시간이 오래 걸림
- 단점
  - 의존성이 높아지며 TDD 할 때 걸림돌이 된다.
  - 단위 테스트는 서로 독립적이어야 하며 순서 상관없이 실행 가능해야한다. 하지만 싱글톤 패턴을 사용하면 각각 독립적인 인스턴스를 만들기 어렵다.
- 구현하는 7가지 방법
  - 단순한 메서드 호출
    ```java
    public class Singleton {
    	private static Singleton instance;

    	private Singleton() {}

    	public static Singleton getInstance() {
    		// 동시에 if 절을 거치게 되면 인스턴스가 여러개 만들어질수도...
    		if (instance == null) {
    			instance = new Singleton();
    		}
    		return instance;
    	}

    }
    ```
  - synchronized
    - 하나의 스레드가 접근했을 때 다른 스레드가 접근 못하도록 함
    - 호출할 때마다 lock이 걸려서 성능 저하
    ```java
    public class Singleton {
    	private static Singleton instance;

    	private Singleton() {}

    	public static synchronized Singleton getInstance() {
    		if (instance == null) {
    			instance = new Singleton();
    		}

    		return instance;
    	}
    }
    ```
  - 정적 멤버
    - 정적 멤버나 블록은 JVM이 클래스 로딩 때 모든 클래스들을 로드할 때 미리 인스턴스를 생성하는데 이를 이용
    - 인스턴스가 필요없는 경우도 무조건 싱글톤 클래스를 호출해 인스턴스를 만들어야해서 자원 낭비 가능성 존재
    ```java
    public class Singleton {
    	private final static Singleton instance = new Singleton();

    	private Singleton() {}

    	public static Singleton getInstance() {
    		return instance;
    	}
    }
    ```
  - **중첩 클래스 (추천)**
    - 인스턴스가 필요할 때만 정적멤버로 선언 → 불필요한 자원 할당 방지
    ```java
    class Singleton {
    	private static class singleInstanceHolder {
    		private static final Singleton INSTANCE = new Singleton();
    	}

    	public static Singleton getInstance() {
    		return singleInstanceHolder.INSTANCE;
    	}
    }
    ```
  - 이중 확인 잠금(DCL)
    - 인스턴스 생성 여부를 싱글톤 패턴 잠금 전에 한번, 객체를 생성하기 전에 한 번 2번 체크하면 인스턴스 존재하지 않을 때만 잠금 걸 수 있다.
    - volatile - 변수를 메인 메모리 기반으로 저장하고 읽어옴. 안붙이면 캐시메모리에서 읽어오기 때문에 변수 불일치 문제 발생
    ```java
    public class Singleton {
    	private volatile Singleton instance;

    	private Singleton() {}

    	public Singleton getInstance() {
    		if (instance == null) {
    			synchronized (Singleton.class) {
    				if (instance == null) {
    					instance = new Singleton();
    				}
    			}
    		}
    		return instance;
    	}
    }
    ```
  - **enum (추천)**
    - enum의 인스턴스는 기본적으로 스레드세이프한 점이 보장
    ```java
    public enum SingletonEnum {
    	INSTANCE;
    	public void oortCloud() {}
    }
    ```
