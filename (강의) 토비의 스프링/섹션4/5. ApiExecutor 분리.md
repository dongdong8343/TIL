- 인터페이스를 도입하고 클래스로 분리를 할 것이다.

- api를 통해 데이터를 가져오는데 api 호출 방법이 달라질 수 있다고 말했었다.

  현재 작성된 코드에서 수정이 일어나면 WebApiExRateProvider 클래스에 변경이 발생한다. 하지만 이것을 원하지 않는다.

  그래서 인터페이스를 도입해서 확장성 있는 코드를 작성해보려고한다.

```java
// 인터페이스
public interface ApiExecutor {
	String execute(URI uri) throws IOException;
}

// 인터페이스 구현
public class SImpleApiExecutor implements ApiExecutor {
	@Override
	public String execute(URI uri) throws IOException {
		String response;
		HttpURLConnection connection = (HttpURLConnection)uri.toURL().openConnection();

		try (BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()))) {
			response = br.lines().collect(Collectors.joining());
		}
		return response;
	}
}

@Component
public class WebApiExRateProvider implements ExRateProvider {
	@Override
	public BigDecimal getExRate(String currency) {
		String url = "https://open.er-api.com/v6/latest/" + currency;

		return runApiForExRate(url);
	}

	private static BigDecimal runApiForExRate(String url) {
		URI uri;
		try {
			uri = new URI(url);
		} catch (URISyntaxException e) {
			throw new RuntimeException(e);
		}

		String response;
		try {
			// 인터페이스 구현체 사용
			response = new SImpleApiExecutor().execute(uri);
		} catch (IOException e) {
			throw new RuntimeException(e);
		}

		...
	}
}
```

- 콜백과 메서드 주입

  - 콜백

    - 실행되는 것이 목적

    - 메서드의 파라미터로 넘겨져서 특정 로직을 담은 메서드 실행이 목적이다.

  - 템플릿과 콜백은 전략 패턴의 특별 케이스

    - 지금 구성을 보면 전략 패턴과 유사하게 보일 것이다. 기본적인 틀이 있는 상태에서 동작하는 방식만 바꿔끼우는 방식으로 구현이 돼있다.

    - 템플릿은 전략패턴의 컨텍스트

    - 콜백은 전략패턴의 전략

  - 메서드 주입

    - 메서드를 호출할 때 파라미터로 전달된다.

    - 의존 관계 주입의 한 종류다.

    - 만약 다른 방식으로 동작하길 원한다면 인터페이스를 구현해서 넘겨주는 부분만 수정해주면 된다.

  ```java
  @Component
  public class WebApiExRateProvider implements ExRateProvider {
      @Override
      public BigDecimal getExRate(String currency) {
          String url = "https://open.er-api.com/v6/latest/" + currency;

          // 변하는 형태를 가진 코드인 콜백을 전달
          return runApiForExRate(url, new SImpleApiExecutor());
      }

      // 템플릿
      private static BigDecimal runApiForExRate(String url, ApiExecutor apiExecutor) {
          URI uri;
          try {
              uri = new URI(url);
          } catch (URISyntaxException e) {
              throw new RuntimeException(e);
          }

          String response;
          try {
              response = apiExecutor.execute(uri);
          } catch (IOException e) {
              throw new RuntimeException(e);
          }

          try {
              return extractExRate(response);
          } catch (JsonProcessingException e) {
              throw new RuntimeException(e);
          }
      }
  }
  ```
